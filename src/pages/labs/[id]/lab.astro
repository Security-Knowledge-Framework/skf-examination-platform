---
import Progress from "../../../components/lab-sandbox/Progress.svelte";
import Quizzes from "../../../components/lab-sandbox/Quizzes.svelte";
import Nav from "../../../components/NavWrapper.astro";
import { getAllLabs } from "../../../db/labs/getAllLabs";
import BaseLayout from "../../../layouts/BaseLayout.astro";
import { checkSession } from "../../../utils/checkSession";

import { Editor } from "../../../components/editor/Editor";

const labs = await getAllLabs();
const { id } = Astro.params;
const lab = labs.find((lab) => lab.id == id);

const isLoggedin = await checkSession(Astro);

if (!lab) {
  return new Response(null, {
    status: 404,
  });
}

const { name } = lab;

const quizzes = [
  {
    title: "Quiz 1",
    description: "Quiz 1 description",
  },
  {
    title: "Quiz 2",
    description: "Quiz 2 description",
  },
  {
    title: "Quiz 3",
    description: "Quiz 3 description",
  },
];
---

<BaseLayout
  title={`SKF | LAB - ${name}`}
  loadNav={false}
  isLoggedin={isLoggedin}
>
  <div class="content">
    <Nav isLoggedin={isLoggedin} />
    <main>
      <div class="write-up">
        <h1>{name}</h1>
        <p>
          Local File Inclusion (also known as LFI) is the process of including
          files, that are already locally present on the server, through the
          exploiting of vulnerable inclusion procedures implemented in the
          application. This vulnerability occurs, for example, when a page
          receives, as input, the path to the file that has to be included and
          this input is not properly sanitized, allowing directory traversal
          characters (such as dot-dot-slash) to be injected. Although most
          examples point to vulnerable PHP scripts, we should keep in mind that
          it is also common in other technologies such as JSP, ASP and others.
        </p>
        <Quizzes quizzes={quizzes} client:load />
      </div>
      <Editor value={`const x = "Hello There";\nconsole.log(x)`} client:load />
      <!-- src="https://www.securityknowledgeframework.org/" -->
      <iframe
        src={`/lab-sandbox-sample/?lab=${name}`}
        width="100%"
        height="100%"
        allowfullscreen=""
        aria-hidden="false"
        tabindex="0"></iframe>
    </main>
    <footer>
      <Progress client:load />
      <a href={`/labs/${id && +id + 1}/lab/`} class="next-lab">Next Lab</a>
    </footer>
  </div>
</BaseLayout>

<style>
  :global(html, body) {
    height: 100%;
  }

  .content :global(nav) {
    margin-bottom: 0;
  }

  h1 {
    margin-bottom: 2rem;
  }

  .content {
    display: grid;
    grid-template-rows: auto 1fr auto;
    height: 100%;
  }

  .content > * {
    border-top: 1px solid #ccc;
  }

  .write-up {
    padding: 2rem 2rem;
  }

  .write-up > p {
    margin-bottom: 2rem;
  }

  main {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    height: 100%;
    overflow-y: hidden;
  }

  main > * {
    overflow-y: auto;
  }

  footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 2rem;
  }

  iframe {
    border: none;
  }
</style>
